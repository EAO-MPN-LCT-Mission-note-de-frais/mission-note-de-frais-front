<div class="p-5 modal-content">
  <h2 mat-dialog-title class="modal-title">{{ data ? 'Modifier' : 'Créer' }} une dépense</h2>

  <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()" class="form-container">

    <!-- Date -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Date</mat-label>
      <input matInput type="date" formControlName="date" />
      @if (expenseForm.get('date')?.hasError('required')) {
        <mat-error>La date est obligatoire.</mat-error>
      }
      @if (expenseForm.get('date')?.hasError('dateBeforeMissionStart') && !expenseForm.get('date')?.hasError('required')) {
        <mat-error>La date ne peux pas être antérieur au début de la mission ({{ data.missionStartDate | date: 'dd-MM-yyyy' }}).</mat-error>
      }
    </mat-form-field>

    <!-- Expense Type -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Nature de frais</mat-label>
      <mat-select formControlName="expenseType">
        @for (type of expenseTypeOptions; track type.name) {
          <mat-option [value]="type.name">
            {{ type.name }}
          </mat-option>
        }
      </mat-select>
      @if (expenseForm.get('expenseType')?.hasError('required')) {
        <mat-error>La nature de frais est obligatoire.</mat-error>
      }
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description" placeholder="Saisir une description (optionnel)"></textarea>
    </mat-form-field>

    <!-- Amount -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Montant TTC (en €)</mat-label>
      <input matInput type="number" formControlName="amount" placeholder="Saisir le montant de la dépense" />
      @if (expenseForm.get('amount')?.hasError('required')) {
        <mat-error>Le montant de la dépense est obligatoire.</mat-error>
      }
      @if (expenseForm.get('amount')?.hasError('strictlyPositive') && !expenseForm.get('amount')?.hasError('required')) {
        <mat-error>Le montant doit être supérieur à 0.</mat-error>
      }
    </mat-form-field>

    <!-- Tax -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>TVA (en %)</mat-label>
      <input matInput type="number" formControlName="tax" placeholder="Saisir le pourcentage de TVA (ex:20)" [disabled]="!expenseForm.get('tax')?.enabled" />
      @if (expenseForm.get('tax')?.hasError('min')) {
        <mat-error>La TVA doit être supérieur ou égale à 0.</mat-error>
      }
    </mat-form-field>

    <!-- Buttons -->
    <div class="dialog-actions">
      <button mat-button type="button" (click)="onCancel()">Annuler</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="expenseForm.invalid">Enregistrer</button>
    </div>
  </form>
</div>
